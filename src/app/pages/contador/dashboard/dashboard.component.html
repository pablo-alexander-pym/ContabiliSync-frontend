<div class="dashboard-container">
  <!-- Header del Dashboard -->
  <div class="dashboard-header">
    <div class="row align-items-center">
      <div class="col-12 col-md-8">
        <h1 class="dashboard-title">
          <i class="fas fa-user-tie me-2"></i>Dashboard Contador
        </h1>
        <p class="dashboard-subtitle mb-0" *ngIf="currentUser$ | async as user">
          Bienvenido, {{ user.nombre }}
        </p>
      </div>
      <div class="col-12 col-md-4 text-md-end">
        <div class="dashboard-date">
          <i class="fas fa-calendar-alt me-2"></i>
          {{ getCurrentDate() | date : "fullDate" : "es-CO" }}
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="text-center py-5" *ngIf="isLoading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando información del dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!isLoading">
    <!-- Estadísticas Rápidas -->
    <div class="row mb-4">
      <div class="col-12">
        <h5 class="section-title">
          <i class="fas fa-chart-bar me-2"></i>Resumen de Actividad
        </h5>
      </div>
      <div class="col-6 col-md-3 mb-3" *ngFor="let stat of dashboardStats">
        <div class="stats-card" [class]="'stats-card-' + stat.color">
          <div class="stats-icon">
            <i [class]="stat.icon"></i>
          </div>
          <div class="stats-content">
            <div class="stats-value">{{ stat.value }}</div>
            <div class="stats-label">{{ stat.label }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Citas de Hoy -->
    <div class="row mb-4" *ngIf="citasHoy.length > 0">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-calendar-day me-2 text-primary"></i>
              Citas de Hoy ({{ citasHoy.length }})
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-12 col-lg-6 mb-3" *ngFor="let cita of citasHoy">
                <div class="appointment-card">
                  <div class="appointment-header">
                    <div class="appointment-time">
                      <i class="fas fa-clock me-1"></i>
                      {{ cita.hora }} -
                      {{ getTimeFromNow(cita.fecha, cita.hora) }}
                    </div>
                    <span [class]="getEstadoCitaClass(cita.estado)">
                      {{ cita.estado | titlecase }}
                    </span>
                  </div>
                  <div class="appointment-content">
                    <h6 class="appointment-client">
                      <i class="fas fa-user me-1"></i>
                      {{
                        cita.contribuyente?.nombre ||
                          cita.usuario?.nombre ||
                          "Usuario"
                      }}
                    </h6>
                    <p class="appointment-type">
                      <i class="fas fa-tag me-1"></i>
                      {{ cita.tipoConsulta || "Consulta general" }}
                    </p>
                    <p
                      class="appointment-description"
                      *ngIf="cita.descripcion || cita.notas"
                    >
                      {{ cita.descripcion || cita.notas }}
                    </p>
                  </div>
                  <div
                    class="appointment-actions"
                    *ngIf="cita.estado === 'pendiente'"
                  >
                    <button
                      class="btn btn-sm btn-success me-2"
                      (click)="confirmarCita(cita.id)"
                    >
                      <i class="fas fa-check me-1"></i>Confirmar
                    </button>
                    <button
                      class="btn btn-sm btn-primary"
                      (click)="completarCita(cita.id)"
                    >
                      <i class="fas fa-check-double me-1"></i>Completar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="row">
      <!-- Citas Pendientes -->
      <div class="col-12 col-lg-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-clock me-2 text-warning"></i>
              Citas Pendientes
            </h5>
          </div>
          <div class="card-body">
            <div
              class="list-group list-group-flush"
              *ngIf="citasPendientes.length > 0; else noPendientes"
            >
              <div
                class="list-group-item"
                *ngFor="let cita of citasPendientes.slice(0, 5)"
              >
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <h6 class="mb-1">
                      {{
                        cita.contribuyente?.nombre ||
                          cita.usuario?.nombre ||
                          "Usuario"
                      }}
                    </h6>
                    <p class="mb-1 text-muted small">
                      <i class="fas fa-calendar me-1"></i>
                      {{ formatearFechaCompleta(cita.fecha) }}
                    </p>
                    <p class="mb-1 text-muted small">
                      <i class="fas fa-clock me-1"></i>
                      {{ cita.hora }}
                    </p>
                    <small class="text-muted">{{
                      cita.tipoConsulta || "Consulta general"
                    }}</small>
                  </div>
                  <div class="text-end">
                    <button
                      class="btn btn-sm btn-outline-success mb-1"
                      (click)="confirmarCita(cita.id)"
                    >
                      <i class="fas fa-check"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noPendientes>
              <div class="text-center py-4">
                <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
                <p class="text-muted">No hay citas pendientes por confirmar</p>
              </div>
            </ng-template>
          </div>
          <div
            class="card-footer text-center"
            *ngIf="citasPendientes.length > 5"
          >
            <a routerLink="/citas" class="btn btn-outline-primary btn-sm">
              Ver todas las citas pendientes
            </a>
          </div>
        </div>
      </div>

      <!-- Próximas Citas -->
      <div class="col-12 col-lg-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-calendar-alt me-2 text-info"></i>
              Próximas Citas
            </h5>
          </div>
          <div class="card-body">
            <div
              class="list-group list-group-flush"
              *ngIf="proximasCitas.length > 0; else noProximas"
            >
              <div
                class="list-group-item"
                *ngFor="let cita of proximasCitas.slice(0, 5)"
              >
                <div class="d-flex justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <h6 class="mb-1">
                      {{
                        cita.contribuyente?.nombre ||
                          cita.usuario?.nombre ||
                          "Usuario"
                      }}
                    </h6>
                    <p class="mb-1 text-muted small">
                      <i class="fas fa-calendar me-1"></i>
                      {{ formatearFecha(cita.fecha) }}
                    </p>
                    <p class="mb-1 text-muted small">
                      <i class="fas fa-clock me-1"></i>
                      {{ cita.hora }}
                    </p>
                    <small class="text-muted">{{
                      cita.tipoConsulta || "Consulta general"
                    }}</small>
                  </div>
                  <div class="text-end">
                    <span [class]="getEstadoCitaClass(cita.estado)">
                      {{ cita.estado | titlecase }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noProximas>
              <div class="text-center py-4">
                <i class="fas fa-calendar-times text-muted fa-3x mb-3"></i>
                <p class="text-muted">No hay próximas citas programadas</p>
              </div>
            </ng-template>
          </div>
          <div class="card-footer text-center" *ngIf="proximasCitas.length > 5">
            <a routerLink="/citas" class="btn btn-outline-primary btn-sm">
              Ver todas las próximas citas
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Acciones Rápidas -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-bolt me-2 text-warning"></i>
              Acciones Rápidas
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-6 col-md-3 mb-3">
                <a routerLink="/calendario" class="action-card">
                  <div class="action-icon bg-primary">
                    <i class="fas fa-calendar-plus"></i>
                  </div>
                  <div class="action-content">
                    <h6>Ver Calendario</h6>
                    <small>Gestionar horarios</small>
                  </div>
                </a>
              </div>
              <div class="col-6 col-md-3 mb-3">
                <a routerLink="/citas" class="action-card">
                  <div class="action-icon bg-success">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="action-content">
                    <h6>Gestionar Citas</h6>
                    <small>Confirmar y organizar</small>
                  </div>
                </a>
              </div>
              <div class="col-6 col-md-3 mb-3">
                <a routerLink="/clientes" class="action-card">
                  <div class="action-icon bg-info">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="action-content">
                    <h6>Mis Clientes</h6>
                    <small>Gestionar clientes</small>
                  </div>
                </a>
              </div>
              <div class="col-6 col-md-3 mb-3">
                <a routerLink="/documentos" class="action-card">
                  <div class="action-icon bg-warning">
                    <i class="fas fa-file-alt"></i>
                  </div>
                  <div class="action-content">
                    <h6>Documentos</h6>
                    <small>Revisar archivos</small>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
